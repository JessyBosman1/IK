<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Opdracht2 - Jessy Bosman</title>

  </head>
  <body>
  <select id ="Year">
  <option value="2005">2005</option>
  <option value="2006">2006</option>
  <option value="2007">2007</option>
  <option value="2008">2008</option>
  <option value="2009">2009</option>
  <option value="2010">2010</option>
  <option value="2011">2011</option>
  <option value="2012">2012</option>
  <option value="2013">2013</option>
  <option value="2014">2014</option>
  <option value="2015">2015</option>
  <option value="Total">Total</option>

  
</select>
<input type="button" value="Generatie Pie Diagram" OnClick="GeneratePie()"/>
    
	<div id="chart"></div>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script>


var Year = null
function GeneratePie() {
        Year = document.getElementById('Year').value;
		console.log(Year);
		RefreshPie(Year)
       }
function RefreshPie(init) {

	d3.csv("Data/All_Imports_Ten_Category.csv", function(dataset) {
		dataset.forEach(function(d) {

				d["2005"] = +d["2005"];
				d["2006"] = +d["2006"];
				d["2007"] = +d["2007"];
				d["2008"] = +d["2008"];
				d["2009"] = +d["2009"];
				d["2010"] = +d["2010"];
				d["2011"] = +d["2011"];
				d["2012"] = +d["2012"];
				d["2013"] = +d["2013"];
				d["2014"] = +d["2014"];
				d["2015"] = +d["2015"];	
				d["Total"] = +d["Total"];	
				}
				);

        var width = 100;
        var height = 100;	
		
		var w = 600,                       
		h = 600,                        
		r = 300,                            
		color = d3.scale.category20c();  
	
        var radius = Math.min(width, height) / 2;
        var color = d3.scale.category20b();
		
		chart.innerHTML = "";
		var vis = d3.select("#chart")
        .append("svg:svg")             
        .data([dataset])                  
        .attr("width", w)           
        .attr("height", h)
        .append("svg:g")                
        .attr("transform", "translate(" + r + "," + r + ")")   
			
    var arc = d3.svg.arc()              
        .innerRadius(r/2.2)
		.outerRadius(r);
		
    var pie = d3.layout.pie()           
        .value(function(d) {return d[init]; })   
		
    var arcs = vis.selectAll("g.slice")     
        .data(pie)                         
        .enter()                            
           .append("svg:g")               
                .attr("class", "slice");  
        arcs.append("svg:path")
                .attr("fill", function(d, i) { return color(i); } )
                .attr("d", arc)                                 
	
	.on("mouseover", function(d, i) {
          //console.log(d);
          arcs.append("text")
            .attr("dy", ".5em")
            .style("text-anchor", "middle")
            .style("font-size", 25)
            .attr("class","label")
            .style("fill", function(d,i){return "black";})
            .text(dataset[i].category + ": " + dataset[i][init] + "$ ");
      })
      .on("mouseout", function(d) {
        arcs.select(".label").remove();
      });
    
	arcs.append("path")		
		
		var getAngle = function (d) {
			return (180 / Math.PI * (d.startAngle + d.endAngle) / 2 + 90);
		}; 
        arcs.append("svg:text")                                    
				.attr("transform", function(d) {                   
                d.innerRadius = 200;
                d.outerRadius = r;
				d.Angle = 90;
                return "translate(" + arc.centroid(d) + ") rotate("+ getAngle(d) +")";
            })
            .attr("text-anchor", "middle")
			.style("fill", function(d,i){return "white";})			
            .text(function(d, i) {return dataset[i].category ; });   		
		  });
	}

    </script>
  </body>
</html>